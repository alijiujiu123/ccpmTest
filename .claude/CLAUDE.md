# CLAUDE.md

> 仔细思考并实现最简洁的解决方案，尽可能少改动代码。

## 使用子代理进行上下文优化

### 1. 当要求读取文件时，始终使用文件分析器子代理
文件分析器代理擅长从文件中提取和总结关键信息，特别是日志文件和冗长输出。它提供简洁、可操作的摘要，在显著减少上下文使用的同时保留基本信息。

### 2. 当要求搜索代码、分析代码、研究错误或追踪逻辑流程时，始终使用代码分析器子代理

代码分析器代理擅长代码分析、逻辑追踪和漏洞检测。它提供简洁、可操作的摘要，在显著减少上下文使用的同时保留基本信息。

### 3. 始终使用测试运行器子代理来运行测试并分析测试结果

使用测试运行器代理确保：

- 完整的测试输出被捕获用于调试
- 主对话保持清洁和专注
- 上下文使用得到优化
- 所有问题都得到适当呈现
- 没有批准对话框中断工作流程

## 哲学

### 错误处理

- **快速失败** 对于关键配置（缺失文本模型）
- **记录并继续** 对于可选功能（提取模型）
- **优雅降级** 当外部服务不可用时
- **用户友好消息** 通过弹性层传递

### 测试

- 始终使用测试运行器代理执行测试。
- 永远不要为任何事情使用模拟服务。
- 在当前测试完成之前不要继续下一个测试。
- 如果测试失败，在决定需要重构代码库之前，考虑检查测试结构是否正确。
- 测试要详细，以便我们可以使用它们进行调试。

## 语气和行为

- 欢迎批评。请告诉我什么时候我错了或误解了，或者即使你认为我可能错了或误解了。
- 请告诉我是否有比我正在采用的方法更好的方法。
- 请告诉我是否有我似乎不知道的相关标准或约定。
- 保持怀疑态度。
- 保持简洁。
- 简短的总结是可以的，但除非我们正在处理计划的细节，否则不要给出扩展的分解。
- 不要奉承，除非我特别要求你的判断，否则不要给予赞美。
- 偶尔的客套话是可以的。
- 随时提问。如果你对我的意图有疑问，不要猜测。问。

## 绝对规则：

- 没有部分实现
- 没有简化：不要使用"//这是简化的东西，完整的实现会blablabla"
- 没有代码重复：检查现有代码库以重用函数和常量。在编写新函数之前阅读文件。使用常识性函数名称以便轻松找到它们。
- 没有死代码：要么使用，要么从代码库中完全删除
- 为每个函数实现测试
- 没有作弊测试：测试必须准确，反映真实使用情况，并设计为揭示缺陷。没有无用的测试！设计测试要详细，以便我们可以使用它们进行调试。
- 没有不一致的命名 - 阅读现有代码库命名模式。
- 没有过度工程 - 当简单函数可以工作时，不要添加不必要的抽象、工厂模式或中间件。当你需要"工作"时不要想"企业级"
- 没有混合关注点 - 不要将验证逻辑放在API处理程序中，不要将数据库查询放在UI组件中，等等，而应该进行适当的分离
- 没有资源泄漏 - 不要忘记关闭数据库连接、清除超时、移除事件监听器或清理文件句柄

## 语言规则

- 所有新生成的文件和文档输出必须使用中文
- 代码注释应使用中文，除非涉及技术术语
- 错误信息和日志输出使用中文
- 用户界面文本和提示信息使用中文
- API文档和技术文档使用中文编写
- 测试用例和测试描述使用中文
- 提交消息和版本说明使用中文